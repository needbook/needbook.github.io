"use strict";function Author(a){this.EntityType="Author",angular.extend(this,a)}function Book(a){this.EntityType="Book",angular.extend(this,a)}function Character(a){this.EntityType="Character",angular.extend(this,a)}function Client(a){this.EntityType="Client",angular.extend(this,a)}function Edition(a){this.EntityType="Edition",angular.extend(this,a)}function Search(a){this.EntityType="Search",angular.extend(this,a)}function Serie(a){this.EntityType="Serie",angular.extend(this,a)}function User(a){this.EntityType="User",this.Books=[],this.booksLoaded=!1,angular.extend(this,a),this.Firstname&&this.Lastname?this.Fullname=this.Firstname+" "+this.Lastname:this.Fullname=this.Firstname||this.Lastname,this.loadBooks=function(a,b){var c=this;c.booksLoaded?b():a.ofUser({userID:c.id},function(a){c.Books=a,c.booksLoaded=!0,b()})},this.addBook=function(a){this.Books.push(a)}}angular.module("needbookApp",["ngAnimate","ngAria","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","ngMdIcons","ui.router","md.data.table","app.ngResource","app.underscore","apiModels","authControllers","authorControllers","bookControllers","serieControllers"]).run(["$rootScope","$state","AUTH_EVENTS","AuthService",function(a,b){a.$on("$stateChangeError",function(){b.go("home.login")})}]);var needbookApp=angular.module("needbookApp");needbookApp.config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,b,c){return{responseError:function(d){return a.$broadcast({401:c.notAuthenticated,403:c.notAuthorized,419:c.sessionTimeout,440:c.sessionTimeout}[d.status],d),b.reject(d)}}}]);var needbookApp=angular.module("needbookApp");needbookApp.constant("AUTH_EVENTS",{clientAuthSuccess:"auth:client-success",clientAuthFailed:"auth:client-failed",registrationSuccess:"auth:registration-success",registrationFailed:"auth:registration-failed",deletionSuccess:"auth:deletion-success",deletionFailed:"auth:deletion-failed",loginSuccess:"auth:login-success",loginFailed:"auth:login-failed",logoutSuccess:"auth:logout-success",sessionCreated:"auth:session-created",sessionDeleted:"auth:session-deleted",sessionTimeout:"auth:session-timeout",notAuthenticated:"auth:not-authenticated",notAuthorized:"auth:not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"});var needbookApp=angular.module("needbookApp");needbookApp.controller("AppCtrl",["$log","$rootScope","$scope","$state","$mdToast","USER_ROLES","AUTH_EVENTS","AuthService","Session",function(a,b,c,d,e,f,g,h,i){b.title="Page Title",c.currentUser=null,c.userRoles=f,c.isAuthorized=h.isAuthorized,h.clientConnection(),c.logout=h.logout,c.$on(g.loginSuccess,function(){e.show(e.simple().position("bottom right").content("Login Success")),d.go("app.library.books")}),c.$on(g.loginFailed,function(){e.show(e.simple().position("bottom right").content("Login Failure"))}),c.$on(g.deletionSuccess,function(){e.show(e.simple().position("bottom right").content("Account Deleted"))}),c.$on(g.deletionFailure,function(){e.show(e.simple().position("bottom right").content("Account Deletion Failed"))}),c.$on(g.sessionCreated,function(){c.currentUser||(c.currentUser=i.loadState())}),c.$on(g.sessionDeleted,function(){c.currentUser=null,d.go("home.login")})}]);var needbookApp=angular.module("needbookApp");needbookApp.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){c.defaults.withCredentials=!0,b.otherwise("/library/books"),a.state("home",{url:"/home",data:{requireLogin:!1},views:{header:{templateUrl:"components/home/toolbar/homeToolbarView.html",controller:"HomeToolbarCtrl"},content:{templateUrl:"components/home/homeView.html"}}}).state("home.login",{url:"/login",views:{"content@":{templateUrl:"components/auth/loginView.html",controller:"LoginCtrl"}}}).state("home.sign_up",{url:"/sign_up",views:{"content@":{templateUrl:"components/auth/signUpView.html",controller:"SignUpCtrl"}}}).state("app",{"abstract":!0,data:{requireLogin:!0},resolve:{auth:["AuthResolver",function(a){return a.resolve()}]},views:{header:{templateUrl:"shared/core/toolbar/simpleToolbarView.html",controller:"SimpleToolbarCtrl"},sidenav:{templateUrl:"shared/core/sidenav/sidenavView.html",controller:"SidenavCtrl"}}}).state("app.search",{url:"/search/:query",views:{"content@":{templateUrl:"components/search/searchResultView.html",controller:"SearchCtrl"}}}).state("app.book",{url:"/book/:bookID","abstract":!0,views:{"header@":{templateUrl:"shared/core/toolbar/libraryToolbarView.html",controller:"BookToolbarCtrl"}}}).state("app.book.details",{url:"",views:{"content@":{templateUrl:"components/book/bookDetailView.html",controller:"BookDetailCtrl"}}}).state("app.book.characters",{url:"/chars",views:{"content@":{templateUrl:"components/book/character/bookCharacterListView.html",controller:"BookCharacterListCtrl"}}}).state("app.book.character",{url:"/char/:charID",views:{"content@":{templateUrl:"components/book/character/bookCharacterDetailView.html",controller:"BookCharacterDetailCtrl"}}}).state("app.serie",{url:"/serie/:id",views:{"content@":{templateUrl:"components/serie/serieDetailView.html",controller:"SerieDetailCtrl"}}}).state("app.author",{url:"/author/:id",views:{"content@":{templateUrl:"components/author/authorDetailView.html",controller:"AuthorDetailCtrl"}}}).state("app.library",{url:"/library","abstract":!0,views:{"header@":{templateUrl:"shared/core/toolbar/simpleToolbarView.html",controller:"LibraryToolbarCtrl"}}}).state("app.library.books",{url:"/books",views:{"content@":{templateUrl:"components/book/bookListView.html",controller:"BookListCtrl"}}}).state("app.library.series",{url:"/series",views:{"content@":{templateUrl:"components/serie/serieListView.html",controller:"SerieListCtrl"}}}).state("app.library.authors",{url:"/authors",views:{"content@":{templateUrl:"components/author/authorListView.html",controller:"AuthorListCtrl"}}}).state("app.library.favorites",{url:"/favorites",views:{"content@":{templateUrl:"components/book/bookListView.html",controller:"FavoriteBooksCtrl"}}}).state("app.top_books",{url:"/top_books",views:{"content@":{templateUrl:"components/top_books/topBooksView.html",controller:"TopBookListCtrl"}}}).state("app.discover",{url:"/discover",views:{"content@":{templateUrl:"components/discover/discoverView.html",controller:"DiscoverCtrl"}}}).state("app.forum",{url:"/forum",views:{"content@":{templateUrl:"components/forum/forumView.html",controller:"ForumCtrl"}}}).state("app.settings",{url:"/settings",views:{"content@":{templateUrl:"components/settings/settingsView.html",controller:"SettingsCtrl"}}}).state("app.help",{url:"/help",views:{"content@":{templateUrl:"components/help/helpView.html",controller:"HelpCtrl"}}}).state("app.about",{url:"/about",views:{"content@":{templateUrl:"components/about/aboutView.html",controller:"AboutCtrl"}}})}]),angular.module("app.ngResource",["ngResource","ngCookies"]).factory("Resource",["$resource","$cookies",function(a,b){return function(b,c,d){var e=function(a){return angular.forEach(arguments,function(b){b!==a&&angular.forEach(b,function(b,c){a[c]&&a[c].constructor&&a[c].constructor===Object?e(a[c],b):a[c]=b})}),a};delete c.model;var f={post:{method:"POST"},patch:{method:"PATCH"},create:{method:"POST"},update:{method:"PUT",isArray:!1},query:{isArray:!0}};d=e({},f,d),c=angular.extend({id:"@id"},c);var g=a(b,c,d);return g.prototype.$save=function(){return this.id?this.$update():this.$create()},g}}]);var needbookApp=angular.module("needbookApp");needbookApp.factory("config",[function(){var a="production",b={production:{apiUrl:"http://needbook.io:1337",clientName:"Admin",clientKey:"Ls5Peq5sfZcJHhkv54dfsdLg35HVfdff977fHF2S4354ZhkgyklMd5",log:!0},development:{apiUrl:"http://localhost:1337",clientName:"admin",clientKey:"admin",log:!0}};return b[a]}]);var needbookApp=angular.module("needbookApp");needbookApp.config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("teal").accentPalette("amber").warnPalette("red").backgroundPalette("grey")}]);var underscore=angular.module("app.underscore",[]);underscore.factory("_",["$window",function(a){return a._}]),angular.module("apiModels",[]);var apiModels=angular.module("apiModels");apiModels.factory("AuthorModel",["_","Resource","config",function(a,b,c){function d(a){return new Author(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Author(a)})}return b(c.apiUrl+"/authors/:id",{id:"@id"},{query:{transformResponse:e},get:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("BookModel",["_","Resource","config",function(a,b,c){function d(a){return new Book(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Book(a)})}return b(c.apiUrl+"/books/:id",{id:"@id"},{query:{transformResponse:e},get:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("CharacterModel",["_","Resource","config",function(a,b,c){function d(a){return new Character(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Character(a)})}return b(c.apiUrl+"/characters/:id",{id:"@id"},{query:{transformResponse:e},get:{transformResponse:d}})}]),apiModels.factory("BookCharacterModel",["_","Resource","config",function(a,b,c){function d(a){return new Character(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Character(a)})}return b(c.apiUrl+"/books/:bookID/characters/:charID",{bookID:"@bookID",charID:"@charID"},{query:{transformResponse:e},get:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("ClientModel",["_","Resource","config",function(a,b,c){function d(a){return new Client(angular.fromJson(a))}return b(c.apiUrl+"/auth/:client_id",{client_id:"@client_id"},{connect:{method:"GET",url:c.apiUrl+"/auth/"+c.clientName+"/"+c.clientKey},disconnect:{url:c.apiUrl+"/auth/stop"},create:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("EditionModel",["_","Resource","config",function(a,b,c){function d(a){return new Edition(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Edition(a)})}return b(c.apiUrl+"/editions/:id",{id:"@id"},{query:{transformResponse:e},get:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("SearchModel",["_","Resource","config",function(a,b,c){function d(a){return new Search(angular.fromJson(a))}return b(c.apiUrl+"/search?q=:query",{query:"@query"},{query:{transformResponse:d,isArray:!1}})}]);var apiModels=angular.module("apiModels");apiModels.factory("SerieModel",["_","Resource","config",function(a,b,c){function d(a){return new Serie(angular.fromJson(a))}function e(b){return a.map(angular.fromJson(b),function(a){return new Serie(a)})}return b(c.apiUrl+"/series/:id",{id:"@id"},{query:{transformResponse:e},get:{transformResponse:d}})}]);var apiModels=angular.module("apiModels");apiModels.factory("UserModel",["_","Resource","config",function(a,b,c){function d(a){return new User(angular.fromJson(a))}return b(c.apiUrl+"/users/:id",{id:"@id"},{create:{method:"POST",transformResponse:d},login:{url:c.apiUrl+"/users/login"},logout:{url:c.apiUrl+"/users/logout"},validateEmail:{url:c.apiUrl+"/user/validate/:login/:key",method:"POST"}})}]);var needbookApp=angular.module("needbookApp");needbookApp.factory("AuthService",["_","$log","AUTH_EVENTS","BroadcastService","ClientModel","UserModel","Session",function(a,b,c,d,e,f,g){var h={};return h.clientConnection=function(){e.connect(function(a){d.sendSuccess(c.clientAuthSuccess,a)},function(a){d.sendFailure(c.clientAuthSuccess,a)})},h.currentUser=function(a,b){f.get({id:g.uid},function(b){a(b)},b)},h.login=function(a){f.login(a,function(a){g.saveState(a.user),g.create(a.user.id),d.sendSuccess(c.loginSuccess,a.user)},function(a){d.sendFailure(c.loginFailed,a)})},h.logout=function(){g.destroy()},h.register=function(b){f.create(b,function(b){d.sendSuccess(c.registrationSuccess,b),h.login(a.pick(b,"login","password"))},function(a){d.sendFailure(c.registrationFailed,a)})},h.deleteUser=function(a){f["delete"]({id:a},function(a){d.sendSuccess(c.deletionSuccess,a),h.logout()},function(a){d.sendFailure(c.deletionFailed,a)})},h.isAuthenticated=function(){return b.info("authService.isAuthenticated",!!g.userId),!!g.userId},h.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),b.info("authService.isAuthorized",h.isAuthenticated()&&-1!==a.indexOf(g.userRole)),h.isAuthenticated()&&-1!==a.indexOf(g.userRole)},h}]),needbookApp.factory("AuthResolver",["$cookies","$q","Session",function(a,b,c){return{resolve:function(){var d=b.defer(),e=a.get("uid");return e?(c.create(e),d.resolve()):d.reject("Not logged in"),d.promise}}}]);var needbookApp=angular.module("needbookApp");needbookApp.factory("BroadcastService",["$log","$rootScope","config",function(a,b,c){var d={};return d.send=function(a,c){b.$broadcast(a,c)},d.sendSuccess=function(b,e){c.log&&a.info(b,e),d.send(b,e)},d.sendFailure=function(b,e){c.log&&a.warn(b,e),d.send(b,e)},d}]);var needbookApp=angular.module("needbookApp");needbookApp.service("Session",["$log","$cookies","BroadcastService","AUTH_EVENTS","USER_ROLES",function(a,b,c,d,e){this.loadState=function(){var b=localStorage.getItem("user");return a.debug("Session.loadState",null!==localStorage.getItem("user")?angular.fromJson(b):null),null!==localStorage.getItem("user")?angular.fromJson(b):null},this.saveState=function(b){localStorage.setItem("user",angular.toJson(b)),a.debug("Session.saveState",angular.toJson(b))},this.deleteState=function(){localStorage.removeItem("user")},this.create=function(a,f){this.uid=a,this.userRole=f||e.admin,b.put("uid",a),c.sendSuccess(d.sessionCreated,a)},this.destroy=function(){this.uid=null,this.userRole=null,this.deleteState(),b.remove("uid"),c.sendSuccess(d.sessionDeleted)}}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("AuthorCardCtrl",["$scope",function(a){a.ctrlName="AuthorCardCtrl"}]),needbookApp.directive("authorCard",function(){return{restrict:"E",scope:{author:"="},templateUrl:"shared/author/authorCard.tmpl.html",controller:"AuthorCardCtrl"}});var needbookApp=angular.module("needbookApp");needbookApp.controller("BookCardCtrl",["$scope",function(a){a.ctrlName="BookCardCtrl"}]),needbookApp.directive("bookCard",function(){return{restrict:"E",scope:{book:"="},templateUrl:"shared/book/bookCard.tmpl.html",controller:"BookCardCtrl",link:function(a,b,c){var d=c.hovering||"md-whiteframe-z2";b.bind("mouseenter",function(){b.find("md-card").addClass(d)}),b.bind("mouseleave",function(){b.find("md-card").removeClass(d)})}}});var needbookApp=angular.module("needbookApp");needbookApp.controller("SearchInputCtrl",["$scope","$state","$stateParams",function(a,b,c){a.ctrlName="SearchInputCtrl",a.query=c.query||"",a.search=function(c){c.length>1&&b.go("app.search",{query:a.query})}}]),needbookApp.directive("searchInput",function(){return{restrict:"E",templateUrl:"shared/core/search/searchInput.tmpl.html",controller:"SearchInputCtrl"}});var needbookApp=angular.module("needbookApp");needbookApp.controller("SidenavCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})},a.menu=[{subheader:"",links:[{title:"My Library",state:"app.library.books",icon:"my_library_books"},{title:"Top Books",state:"app.top_books",icon:"star"},{title:"Discover",state:"app.discover",icon:"explore"}]},{subheader:"Community",links:[{title:"Forum",state:"app.forum",icon:"forum"}]},{subheader:"Management",links:[{title:"Settings",state:"app.settings",icon:"settings"},{title:"Help & feedback",state:"app.help",icon:"help"}]}]}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("SimpleToolbarCtrl",[function(){}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("LibraryToolbarCtrl",["_","$rootScope","$scope","$state",function(a,b,c,d){function e(){var b=1;return a.find(c.tabs,function(a,c){return d.is(a.state)?(b=c,!0):void 0}),b}b.title="Library",c.tabs=[{title:"Books",state:"app.library.books"},{title:"Series",state:"app.library.series"},{title:"Authors",state:"app.library.authors"},{title:"Favorites",state:"app.library.favorites"}],c.selectedIndex=e()}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("BookToolbarCtrl",["_","$log","$rootScope","$scope","$state","$stateParams",function(a,b,c,d,e,f){function g(){var b=1;return a.find(d.tabs,function(a,c){var d=a.state.split("(")[0];return e.is(d)?(b=c,!0):void 0}),b}var h="app.book",i='{ bookID: "'+f.bookID+'"}',j=h+".details("+i+")",k=h+".characters("+i+")",l=h+".places("+i+"})";d.tabs=[{title:"Details",state:j},{title:"Characters",state:k},{title:"Places",state:l}],d.selectedIndex=g()}]),angular.module("authControllers",[]);var authControllers=angular.module("authControllers");authControllers.controller("LoginCtrl",["$log","$scope","AuthService",function(a,b,c){b.credentials={login:"",password:""},b.login=function(a){c.login(a)}}]);var authControllers=angular.module("authControllers");authControllers.controller("SignUpCtrl",["$scope","$mdToast","AUTH_EVENTS","AuthService",function(a,b,c,d){a.user={firstName:"",lastName:"",login:"",email:"",password:"",password_confirmation:"",state:"validated"},a.signUp=function(a){d.register(a)},a.$on(c.registrationSuccess,function(){b.show(b.simple().position("bottom right").content("Registration Success"))}),a.$on(c.registrationFailed,function(){b.show(b.simple().position("bottom right").content("Registration Failure"))})}]),angular.module("authorControllers",[]);var authorControllers=angular.module("authorControllers");authorControllers.controller("AuthorListCtrl",["$rootScope","$scope","AuthorModel",function(a,b,c){var d=c;b.authors=d.query()}]);var authorControllers=angular.module("authorControllers");authorControllers.controller("AuthorDetailCtrl",["$rootScope","$scope","$stateParams","AuthorModel",function(a,b,c,d){var e=d;a.title="Author",b.books={},b.author=e.get({id:c.id},function(c){console.log(c),b.books=c.books,a.title=b.author.names[0]})}]),angular.module("bookControllers",[]);var bookControllers=angular.module("bookControllers");bookControllers.controller("BookListCtrl",["$rootScope","$scope","BookModel",function(a,b,c){b.selectedIndex=1,b.tabs=[{title:"Now Reading",templateUrl:"components/library/readingListView.html"},{title:"Books",templateUrl:"components/library/bookListView.html"},{title:"Authors",templateUrl:"components/library/authorsListView.html"},{title:"Favorites",templateUrl:"components/library/favoritesListView.html"}];var d=c;b.books=d.query()}]);var bookControllers=angular.module("bookControllers");bookControllers.controller("BookDetailCtrl",["$rootScope","$scope","$stateParams","BookModel",function(a,b,c,d){var e=d;a.title="Book",b.author={},b.edition={},b.book=e.get({id:c.bookID},function(c){b.author=c.authors[0],b.edition=c.editions[0],a.title=b.book.title})}]);var bookControllers=angular.module("bookControllers");bookControllers.controller("FavoriteBooksCtrl",["$rootScope","$scope","BookModel",function(a,b,c){var d=c;b.books=d.query()}]);var bookControllers=angular.module("bookControllers");bookControllers.controller("BookCharacterListCtrl",["$rootScope","$scope","$stateParams","BookCharacterModel",function(a,b,c,d){var e=d;b.characters=e.query({bookID:c.bookID})}]);var bookControllers=angular.module("bookControllers");bookControllers.controller("BookCharacterDetailCtrl",["$rootScope","$scope","$stateParams","BookCharacterModel",function(a,b,c,d){var e=d;a.title="Character",b.character=e.get({bookID:c.id,charID:c.characterID},function(b){a.title=b.name})}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("SearchCtrl",["$rootScope","$scope","$stateParams","$timeout","SearchModel",function(a,b,c,d,e){var f=e;a.title="Search",b.query=c.query,b.results={},b.isComplete=!1,b.isEmpty=!0,d(function(){f.query({query:b.query},function(a){b.results=a,b.isEmpty=!(a.author.length||a.book.length||a.serie.length||a.edition.length),b.isComplete=!0})},500)}]),angular.module("serieControllers",[]);var serieControllers=angular.module("serieControllers");serieControllers.controller("SerieListCtrl",["$rootScope","$scope","SerieModel",function(a,b,c){var d=c;b.series=d.query()}]);var serieControllers=angular.module("serieControllers");serieControllers.controller("SerieDetailCtrl",["$rootScope","$scope","$stateParams","SerieModel",function(a,b,c,d){var e=d;a.title="Serie",b.serie=e.get({id:c.id},function(b){a.title=b.name})}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("HomeCtrl",[function(){}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("HomeToolbarCtrl",["$scope","$state",function(a,b){a.selectedIndex=b.is("home.login")?0:1}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("TopBooksCtrl",["$rootScope","$scope",function(a,b){a.title="Top Books"}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("DiscoverCtrl",["$rootScope","$scope",function(a,b){a.title="Discover"}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("ForumCtrl",["$rootScope","$scope",function(a,b){a.title="Forum"}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("SettingsCtrl",["$rootScope","$scope","$mdDialog","AuthService",function(a,b,c,d){a.title="Settings",b.showConfirm=function(){var a=c.confirm().title("Would you like to delete your account?").content("This action will delete everything including your Library.").ariaLabel("Lucky day").ok("I agree").cancel("Cancel");c.show(a).then(function(){console.log("You decided to delete your account."),d.deleteUser(b.currentUser.id)},function(){console.log("You decided to keep your account.")})}}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("HelpCtrl",["$rootScope","$scope",function(a,b){a.title="Help"}]);var needbookApp=angular.module("needbookApp");needbookApp.controller("AboutCtrl",["$rootScope","$scope",function(a,b){a.title="About"}]);