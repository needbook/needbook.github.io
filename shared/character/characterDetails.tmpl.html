<md-content class="loading fixed-height" ng-show="isLoading">
  <md-progress-circular class="md-accent" md-mode="indeterminate" md-diameter="100"></md-progress-circular>
</md-content>

<md-content class="details-container fixed-height">
  <div class="picture-container">
    <div class="picture">
      <img class="image" ng-if="character.picture()" ng-src="{{book.default_edition.default_image}}" alt="{{book.title}}">
      <div class="default_picture" ng-if="!character.picture()" alt="{{book.title}}">
        <ng-md-icon icon="person" size="200"></ng-md-icon>
      </div>
      <!-- <img src="http://vignette4.wikia.nocookie.net/gameofthrones/images/e/ee/Eddard_and_Petyr_1x07.png/revision/latest/scale-to-width-down/512?cb=20110622085002"> -->
    </div>
    <div class="character-name-container">
      <div class="character-name">
        <h2 class="md-display-1">{{selectedCharacter.name()}}</h2>
      </div>
    </div>
    <div class="action-buttons-container">
      <div class="buttons-left">
        <md-button class="md-icon-button" hide-gt-xs>
          <ng-md-icon icon="arrow_back"></ng-md-icon>
        </md-button>
      </div>
      <div class="buttons-right">
        <md-button class="md-icon-button" aria-label="Edit" ui-sref="app.book.character.edit({charID: charId})">
          <ng-md-icon icon="edit"></ng-md-icon>
        </md-button>
        <md-menu md-position-mode="target-right target">
          <md-button class="md-icon-button" ng-click="$mdOpenMenu($event)">
            <ng-md-icon md-menu-origin icon="more_vert"></ng-md-icon>
          </md-button>
          <md-menu-content width="3">
            <md-menu-item>
              <md-button>
                <div layout="row">
                  <p flex>Share</p>
                  <ng-md-icon md-menu-align-target icon="share"></ng-md-icon>
                </div>
              </md-button>
            </md-menu-item>
            <md-menu-item>
              <md-button class="md-warn" ng-click="deleteCharacter($event)">
                <div layout="row">
                  <p flex>Delete</p>
                  <ng-md-icon md-menu-align-target icon="delete" ></ng-md-icon>
                </div>
              </md-button>
            </md-menu-item>
          </md-menu-content>
        </md-menu>
      </div>
      <!-- <md-button class="md-fab md-accent" aria-label="Edit">
        <ng-md-icon icon="edit"></ng-md-icon>
      </md-button> -->
    </div>
  </div>

  <md-tabs class="md-primary" md-swipe-content md-stretch-tabs="always" >
    <md-tab label="Details">
      <md-content>
        <md-list>
          <md-subheader class="md-no-sticky">Primary Informations</md-subheader>
          <md-list-item>
            <ng-md-icon class="md-avatar-icon" ng-class="selectedCharacter.gender()" ng-show="selectedCharacter.gender()" icon="{{'gender_' + selectedCharacter.gender()}}"></ng-md-icon>
            <ng-md-icon class="md-avatar-icon" ng-hide="selectedCharacter.gender()" icon="gender"></ng-md-icon>
            <p>{{selectedCharacter.name()}}</p>
          </md-list-item>
          <md-divider ></md-divider>
          <md-subheader class="md-no-sticky">Traits</md-subheader>
        <!-- <character-links-card class="character-card" book-id="bookId" char-id="charId"></character-links-card> -->
          <md-list-item class="md-2-line" ng-repeat="characterTrait in selectedCharacter.traits" ng-show="characterTrait.trait.names.en_US != 'Gender'">
            <div class="md-list-item-text md-offset">
              <h3>{{characterTrait.values.en_US[0]}}</h3>
              <p>{{characterTrait.trait.names.en_US}}</p>
            </div>
          </md-list-item>
        </md-list>
      </md-content>
    </md-tab>
    <md-tab label="Timeline">
      <md-content class="md-padding">
        <timeline>
          <timeline-event ng-repeat="(location, events) in events | groupBy: 'calculated_begin_location'">

            <timeline-legend>
              <span ng-if="location != 'null'" class="md-primary">Location {{location}}</span>
              <span ng-if="location == 'null'" class="md-primary">Beginning</span>
            </timeline-legend>

            <timeline-badge class="normal">
              <i class="glyphicon"></i>
            </timeline-badge>

            <timeline-panel>
              <timeline-heading ng-if="events.length > 1">
                <h4>{{events.length}} events:</h4>
              </timeline-heading>
              <div class="list-item" ng-repeat="event in events">
                <div ng-hide="true" style="float:right"><ng-md-icon icon="remove" label="{{'action.remove' | i18next}}" ng-click="deleteEvent(event)" style="cursor:pointer;"></ng-md-icon></div>
                <div ng-if="event.type=='trait'"><strong>{{event.trait.names.en_US}}:</strong> {{event.values.en_US.join(', ')}}</div>
                <div ng-if="event.type=='move'">Moved from <strong><a href="#" ui-sref="app.book.place({ placeID: event.from.id })">{{event.from.indexedTraits().names[event.from.indexedTraits().names.length - 1].values.en_US[0]}}</a></strong> to <strong><a href="#" ui-sref="app.book.place({ placeID: event.to.id })">{{event.from.indexedTraits().names[event.from.indexedTraits().names.length - 1].values.en_US[0]}}</a></strong></div>
                <div ng-if="event.type=='link'">{{event.toSentence('en_US')}}</div>
                <div ng-if="event.type=='action'">{{event.toSentence('en_US')}}</div>
              </div>
            </timeline-panel>
          </timeline-event>
        </timeline>
      </md-content>
    </md-tab>
    <md-tab label="Family tree">
      <md-content class="md-padding">
        <character-tree character="selectedCharacter"></character-tree>
      </md-content>
    </md-tab>
  </md-tabs>
</md-content>
